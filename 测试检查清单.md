# 7.5"V2屏幕显示测试检查清单

## 🔍 完整数据流程检查

### 1. 前端处理（浏览器）
打开浏览器开发者工具（F12）→ Console标签，应该看到：

```
📊 图像统计: 800x480, 像素数:384000, 字节数:48000, 编码后:96000字符
🔤 数据示例(前30字符): pppppppppppppppppppppppppp...
🔤 数据示例(后30字符): ...pppppppppppppppppppppppp
📤 发送块 1: 数据1000字符 + 长度后缀4字符 = 1004字符
📤 发送块 2: 数据1000字符 + 长度后缀4字符 = 1004字符
...
```

**检查点**：
- ✅ 像素数 = width × height = 800 × 480 = 384000
- ✅ 字节数 = 像素数 / 8 = 48000
- ✅ 编码后 = 字节数 × 2 = 96000字符
- ✅ 每块数据 = 1000字符 + 4字符长度 = 1004字符

---

### 2. ESP32接收（串口监视器）

```
📱 初始化EPD类型: 22
✅ EPD初始化完成
   EPD_dispLoad指针: 0x400xxxxx
   EPD型号: 7.5 inch V2

📥 接收数据: 1004 字符 (缓冲区: 1008/2050) → 执行加载
   缓冲区内容示例(前20字符): pppppppppppppppppppp...
   缓冲区内容示例(后20字符): ...ggggLOAD

📥 接收数据: 1004 字符 (缓冲区: 1008/2050) → 执行加载
   缓冲区内容示例(前20字符): pppppppppppppppppppp...
   缓冲区内容示例(后20字符): ...ggggLOAD
...
（共96次，总计96000字符）

🎨 刷新显示...
✅ 显示完成
```

**检查点**：
- ✅ EPD型号: 7.5 inch V2
- ✅ EPD_dispLoad指针不为空
- ✅ 数据格式: 字母 'a'-'p' (小写)
- ✅ 后4字符: "LOAD"
- ✅ 后8字符: [长度word(4字符)][LOAD(4字符)]

---

### 3. 数据格式验证

#### 正确的字符编码
- 字节 `0x00` → `"aa"` (a=0, a=0)
- 字节 `0xFF` → `"pp"` (p=15, p=15)
- 字节 `0x80` → `"ai"` (a=0, i=8)

#### 正确的缓冲区格式
```
[图像数据...][长度word][LOAD]
 ^^^^^^^^^^^   ^^^^      ^^^^
 1000字符      4字符     4字符
```

---

## 🐛 常见问题诊断

### 问题1：全白屏
**可能原因**：
- 像素值反了（黑白颠倒）
- 数据全为0xFF

**检查**：
- 浏览器Console中的数据示例是否全是 "pppppp..."
- 如果是，说明像素值反了

**解决**：修改 `app.js` 第265行
```javascript
// 从
pixelArray.push(gray < 128 ? 0 : 1);
// 改为
pixelArray.push(gray < 128 ? 1 : 0);
```

---

### 问题2：花屏
**可能原因**：
- 数据顺序错误（需要翻转）
- 长度计算错误

**检查**：
- EPD类型22应该在needsFlip列表中
- 数据应该倒序

---

### 问题3：图片错位
**可能原因**：
- 分辨率不匹配
- 偏移值错误

**检查**：
- 网页选择的型号是否为 `7.5" V2 800x480`
- 宽度和高度是否自动设置为800和480

---

### 问题4：显示空白
**可能原因**：
- EPD_dispLoad未被调用
- 数据未发送到EPD

**检查**：
- 串口是否显示"执行加载"
- EPD_dispLoad指针是否不为空

---

## 🧪 快速测试方案

### 测试1：使用纯黑图片
创建一个800x480纯黑色图片，上传测试。
- 预期：屏幕应该全黑
- 如果全白：像素值反了

### 测试2：使用棋盘格图片
创建800x480黑白格子图片。
- 预期：屏幕显示清晰的格子
- 如果错位/镜像：数据顺序问题

### 测试3：使用文字图片
包含清晰文字的图片。
- 预期：文字清晰可读
- 如果模糊：处理算法问题

---

## 📋 完整测试步骤

1. **重新上传ESP32代码**
2. **重新部署Docker**
3. **打开浏览器Console（F12）**
4. **打开ESP32串口监视器**
5. **上传一张小图片**（100x100先测试）
6. **观察两边的日志**
7. **根据日志诊断问题**

---

## 🎯 预期的正确流程

### 浏览器Console
```
📊 图像统计: 100x100, 像素数:10000, 字节数:1250, 编码后:2500字符
📤 发送块 1: 数据1000字符 + 长度后缀4字符 = 1004字符
📤 发送块 2: 数据1000字符 + 长度后缀4字符 = 1004字符
📤 发送块 3: 数据500字符 + 长度后缀4字符 = 504字符
```

### ESP32串口
```
📱 初始化EPD类型: 22
✅ EPD初始化完成
   EPD_dispLoad指针: 0x4008xxxx
   EPD型号: 7.5 inch V2

📥 接收数据: 1004 字符 (缓冲区: 1008/2050) → 执行加载
   缓冲区内容示例(前20字符): pppppppppppp...
   缓冲区内容示例(后20字符): ...ggggLOAD

📥 接收数据: 1004 字符 → 执行加载
📥 接收数据: 504 字符 → 执行加载

🎨 刷新显示...
e-Paper busy
e-Paper busy release
✅ 显示完成
```

---

现在上传代码并按照这个检查清单测试！把浏览器Console和ESP32串口的完整输出发给我，我能精确定位问题！🔍
